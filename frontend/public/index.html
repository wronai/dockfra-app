<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{APP_NAME}} - Infrastructure Demo</title>
    <style>
        :root {
            --bg: #0f1117; --surface: #1a1d27; --border: #2a2d3a;
            --text: #e4e4e7; --muted: #8b8d98; --accent: #6366f1;
            --green: #22c55e; --red: #ef4444; --orange: #f59e0b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        header { text-align: center; padding: 3rem 0 2rem; }
        header h1 { font-size: 2.5rem; background: linear-gradient(135deg, var(--accent), #a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        header p { color: var(--muted); margin-top: 0.5rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; transition: border-color 0.2s; }
        .card:hover { border-color: var(--accent); }
        .card h3 { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .status { display: inline-block; width: 8px; height: 8px; border-radius: 50%; }
        .status.ok { background: var(--green); box-shadow: 0 0 6px var(--green); }
        .status.err { background: var(--red); box-shadow: 0 0 6px var(--red); }
        .status.pending { background: var(--orange); box-shadow: 0 0 6px var(--orange); }
        .meta { color: var(--muted); font-size: 0.85rem; margin-bottom: 0.75rem; }
        .btn { display: inline-block; padding: 0.6rem 1.2rem; border-radius: 8px; text-decoration: none; font-weight: 500; font-size: 0.9rem; transition: all 0.2s; cursor: pointer; border: none; }
        .btn-primary { background: var(--accent); color: #fff; }
        .btn-primary:hover { background: #4f46e5; }
        .btn-outline { border: 1px solid var(--border); color: var(--text); background: transparent; }
        .btn-outline:hover { border-color: var(--accent); }
        .download-section { margin-top: 3rem; text-align: center; padding: 2rem; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; }
        .download-grid { display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap; }
        .services-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .services-table th, .services-table td { text-align: left; padding: 0.6rem; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .services-table th { color: var(--muted); font-weight: 500; }
        #deploy-mode { display: inline-block; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; }
        .mode-local { background: #1e3a5f; color: #60a5fa; }
        .mode-production { background: #3b1f1f; color: #f87171; }
        footer { text-align: center; padding: 2rem; color: var(--muted); font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>{{APP_NAME}}</h1>
            <p>Infrastructure Demo Platform v{{APP_VERSION}}</p>
            <span id="deploy-mode" class="mode-local">local</span>
        </header>

        <div class="grid">
            <div class="card">
                <h3><span class="status pending" id="status-backend"></span> Backend API</h3>
                <p class="meta">REST API server — PostgreSQL + Redis</p>
                <table class="services-table">
                    <tr><th>Endpoint</th><td id="backend-url">/api/</td></tr>
                    <tr><th>Status</th><td id="backend-status">Checking...</td></tr>
                    <tr><th>Version</th><td id="backend-version">—</td></tr>
                </table>
            </div>
            <div class="card">
                <h3><span class="status pending" id="status-mobile"></span> Mobile Backend</h3>
                <p class="meta">API for mobile apps — GraphQL ready</p>
                <table class="services-table">
                    <tr><th>Endpoint</th><td>/mobile-api/</td></tr>
                    <tr><th>Status</th><td id="mobile-status">Checking...</td></tr>
                    <tr><th>Version</th><td id="mobile-version">—</td></tr>
                </table>
            </div>
            <div class="card">
                <h3><span class="status pending" id="status-db"></span> Database</h3>
                <p class="meta">PostgreSQL 15 — primary data store</p>
                <table class="services-table">
                    <tr><th>Type</th><td>PostgreSQL 15</td></tr>
                    <tr><th>Status</th><td id="db-status">Checking...</td></tr>
                </table>
            </div>
            <div class="card">
                <h3><span class="status pending" id="status-redis"></span> Redis Cache</h3>
                <p class="meta">Redis 7 — cache and pub/sub</p>
                <table class="services-table">
                    <tr><th>Type</th><td>Redis 7</td></tr>
                    <tr><th>Status</th><td id="redis-status">Checking...</td></tr>
                </table>
            </div>
        </div>

        <div class="download-section">
            <h2>Desktop Application</h2>
            <p class="meta">Built with Tauri — cross-platform native app</p>
            <div class="download-grid">
                <a href="/downloads/app-linux-arm.tar.gz" class="btn btn-primary">⬇ Linux ARM (RPi3)</a>
                <a href="/downloads/app-linux-x64.tar.gz" class="btn btn-outline">⬇ Linux x64</a>
                <a href="/downloads/app-windows.msi" class="btn btn-outline">⬇ Windows</a>
                <a href="/downloads/app-macos.dmg" class="btn btn-outline">⬇ macOS</a>
            </div>
        </div>

        <footer>
            <p>{{APP_NAME}} v{{APP_VERSION}} | Deploy: <span id="footer-mode">local</span> | <a href="/api/health" style="color:var(--accent)">API Health</a></p>
        </footer>
    </div>

    <script>
        async function checkService(url, statusEl, versionEl, dotEl) {
            try {
                const r = await fetch(url, { signal: AbortSignal.timeout(5000) });
                const data = await r.json();
                if (statusEl) statusEl.textContent = data.status || 'ok';
                if (versionEl && data.version) versionEl.textContent = data.version;
                if (dotEl) { dotEl.className = 'status ok'; }
            } catch {
                if (statusEl) statusEl.textContent = 'unreachable';
                if (dotEl) { dotEl.className = 'status err'; }
            }
        }

        async function init() {
            checkService('/api/health',
                document.getElementById('backend-status'),
                document.getElementById('backend-version'),
                document.getElementById('status-backend'));
            checkService('/mobile-api/health',
                document.getElementById('mobile-status'),
                document.getElementById('mobile-version'),
                document.getElementById('status-mobile'));
            checkService('/api/db-status',
                document.getElementById('db-status'), null,
                document.getElementById('status-db'));
            checkService('/api/redis-status',
                document.getElementById('redis-status'), null,
                document.getElementById('status-redis'));

            try {
                const r = await fetch('/api/health');
                const d = await r.json();
                if (d.deploy_mode) {
                    const el = document.getElementById('deploy-mode');
                    el.textContent = d.deploy_mode;
                    el.className = d.deploy_mode === 'production' ? 'mode-production' : 'mode-local';
                    document.getElementById('footer-mode').textContent = d.deploy_mode;
                }
            } catch {}
        }
        init();
        setInterval(init, 30000);
    </script>
</body>
</html>
